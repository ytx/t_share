# 要件定義書 - Template Share

## プロジェクト概要
定型文を管理・共有するためのWebアプリケーション。ユーザーが定型文を作成・編集・共有し、文書作成時に効率的に活用できるシステム。

## 技術スタック
- **フロントエンド**: React
- **バックエンド**: Node.js
- **データベース**: PostgreSQL
- **デプロイ**: AWS EC2 (Docker)

## 機能要件

### 1. 認証・権限管理
- **ログイン方式**:
  - Googleログイン（メイン）
  - ユーザ名・パスワードログイン（開発・管理用）
- **ユーザ権限**:
  - 一般ユーザ
  - 管理者
- **管理モード**:
  - 管理者は管理モードのON/OFF切り替えが可能
  - 管理モードON: 全定型文の閲覧・編集可能
  - 管理モードOFF: 一般ユーザと同等の権限

### 2. メイン画面

#### 2.1 レイアウト構造
- **分割パネルレイアウト**: 左右リサイズ可能なパネル
- **左パネル**: 定型文検索
- **右パネル**: 文書作成エディタ

#### 2.2 定型文検索パネル（左側）
**検索条件:**
- キーワード検索
- シーンフィルタ
- 作成者フィルタ
- 状態フィルタ（アクティブ、全て）
- タグフィルタ

**並び順オプション:**
- 最終利用日時
- 更新日時

**表示範囲:**
- 他者が公開している定型文
- 自分の定型文

#### 2.3 文書作成エディタパネル（右側）
**機能:**
- プロジェクト選択
- Aceエディタ（マークダウンモード）
- 定型文ペースト機能
  - モーダルでの変数入力・置換
  - チェックボックス行の削除
- 選択テキストから定型文作成
- 文書プレビュー
- クリップボードへコピー
- 文書保存（プロジェクト別・時系列）

### 3. 定型文管理

#### 3.1 定型文作成・編集モーダル
**入力項目:**
- シーン
- 本文
- 説明
- 状態（下書き・公開）
- タグ
- 履歴管理

**操作:**
- 下書きとして保存
- 公開

#### 3.2 定型文機能
- **履歴管理**: 完全な定型文バージョン追跡
- **使用状況追跡**: ユーザ毎の使用回数と最終使用日時
- **公開共有**: 公開された定型文は全ユーザがアクセス可能
- **変数サポート**: ユーザ変数とプロジェクト変数

### 4. プロジェクト・文書管理

#### 4.1 プロジェクト
- プロジェクト作成・管理
- プロジェクト固有変数
- プロジェクト別文書整理

#### 4.2 文書
- 作成文書の保存
- プロジェクト別整理
- 時系列での閲覧
- クリップボードコピー機能

### 5. 変数管理
- **ユーザ変数**: テンプレート置換用の個人変数
- **プロジェクト変数**: プロジェクト固有変数
- **変数置換**: テンプレートペースト時のモーダルベース入力

### 6. 設定・環境設定

#### 6.1 設定モーダル
**エディタ設定:**
- キーバインド
- 行番号表示
- 行の折り返し
- 空白文字表示

**ユーザ変数:**
- 個人変数の管理

#### 6.2 テーマサポート
- ライトモード
- ダークモード
- ユーザ設定の永続化

### 7. 管理機能（管理者のみ）

#### 7.1 管理機能
- ユーザ管理
- タグ管理
- シーン管理
- プロジェクト管理
- プロジェクト変数設定

#### 7.2 データ管理
- 設定のエクスポート・インポート
- データのエクスポート・インポート
- システム統計

## 技術要件

### 1. パフォーマンス
- レスポンシブなインターフェース
- データベースインデックスを使用した効率的な検索
- 最適化されたテンプレート読み込み

### 2. データ管理
- 適切なインデックスを持つPostgreSQLデータベース
- 全文検索機能
- データ整合性制約

### 3. セキュリティ
- JWTベースの認証
- 安全なパスワードハッシュ化
- SQLインジェクション対策
- XSS対策

### 4. デプロイ
- Dockerコンテナ化
- AWS EC2デプロイ
- 環境ベースの設定管理

## ユーザエクスペリエンス要件

### 1. インターフェースデザイン
- **デスクトップ中心**: モバイル対応は不要
- **リサイズ可能パネル**: ユーザが調整可能なレイアウト
- **テーマサポート**: ライト・ダークモード切り替え
- **レスポンシブなフィードバック**: 読み込み状態とエラーハンドリング

### 2. ワークフロー最適化
- **高速テンプレート検索**: 効率的なフィルタリングと検索
- **シームレス変数置換**: モーダルベースの入力フロー
- **文書保存**: 自動保存と手動保存オプション
- **バージョン管理**: テンプレート履歴の閲覧

### 3. アクセシビリティ
- キーボードナビゲーションサポート
- 明確な視觚的階層
- エラーメッセージの明確さ

## データ要件

### 1. 定型文データ
- タイトル、本文、説明
- シーン分類
- タグ関連付け
- バージョン履歴
- ユーザ別使用統計
- 公開・非公開状態

### 2. ユーザデータ
- 認証情報
- 個人設定
- ユーザ固有変数
- 使用履歴

### 3. プロジェクトデータ
- プロジェクト情報
- プロジェクト変数
- 文書ストレージ
- アクセス制御

## 連携要件

### 1. Google OAuth
- 安全な認証フロー
- ユーザプロフィール同期
- アカウント連携機能

### 2. エディタ連携
- Aceエディタの統合
- マークダウンサポート
- シンタックスハイライト
- カスタムキーバインド

## 制約・前提条件

### 1. 技術的制約
- デスクトップ専用インターフェース（初期段階ではモバイル対応なし）
- PostgreSQLデータベース必須
- Dockerデプロイメント必須

### 2. ビジネス制約
- シンプルな権限モデル（複雑な役割ベースアクセスなし）
- 全体公開のみ（細かい共有権限設定なし）
- 初期段階では英語サポート

### 3. 前提条件
- ユーザはMarkdown記法に慣れ親しんでいる
- Google OAuthのためのインターネット接続
- モダンブラウザサポート（Chrome、Firefox、Safari、Edge）
# T-SHARE Log Rotation Configuration
# Environment: {{ environment }}

{{ log_dir }}/**/*.log {
    daily
    rotate {{ log_rotation_days }}
    compress
    delaycompress
    missingok
    notifempty
    create 0644 {{ app_user }} {{ app_group }}
    sharedscripts

    postrotate
        # Restart application to reopen log files
        systemctl reload {{ app_name }} > /dev/null 2>&1 || true

        # Restart nginx to reopen log files
        systemctl reload nginx > /dev/null 2>&1 || true
    endscript
}

# Nginx logs
{{ log_dir }}/nginx/*.log {
    daily
    rotate {{ log_rotation_days }}
    compress
    delaycompress
    missingok
    notifempty
    create 0644 www-data www-data
    sharedscripts

    postrotate
        systemctl reload nginx > /dev/null 2>&1 || true
    endscript
}